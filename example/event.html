<!doctype>
<html>

<head>
<script type="text/javascript" src="../dist/web3.js"></script>
<script type="text/javascript" src="js/namereg.js"></script>
<script type="text/javascript">

var walletAbi = [
  {
    "constant": false,
    "inputs": [],
    "name": "nameRegAddress",
    "outputs": [
      {
        "name": "",
        "type": "address"
      }
    ],
    "type": "function"
  },
  {
    "constant": false,
    "inputs": [
      {
        "name": "value",
        "type": "uint256"
      }
    ],
    "name": "spend",
    "outputs": [],
    "type": "function"
  },
  {
    "constant": false,
    "inputs": [
      {
        "name": "name",
        "type": "bytes32"
      }
    ],
    "name": "named",
    "outputs": [
      {
        "name": "",
        "type": "address"
      }
    ],
    "type": "function"
  },
  {
    "constant": false,
    "inputs": [
      {
        "name": "_phone",
        "type": "string"
      }
    ],
    "name": "setPhone",
    "outputs": [],
    "type": "function"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": false,
        "name": "phone",
        "type": "string"
      },
      {
        "indexed": false,
        "name": "value",
        "type": "uint256"
      }
    ],
    "name": "Notify",
    "type": "event"
  }
]


    var Web3 = require('web3');
    var web3 = new Web3();
    var providerUrl = 'http://lior.ide.tmp.ether.camp:8555/sandbox/1205df90136df791b1d7d2c21bb20efec72f9bb0'
    web3.setProvider(new web3.providers.HttpProvider(providerUrl));
    web3.eth.defaultAccount = "0x4ed0c969c46e1240173679183a31cf4d104c232c";
    
    var nameReg = getNameReg(web3);
    var WalletContract = web3.eth.contract(walletAbi);
    var walletInstance;
    
    function onload() {
        console.log("loaded");
        nameReg.addressOf('Wallet', function(err, address) {
            console.log(address);
            setWallet(address);
        });
    }
    
    var walletNotify;
    
    function setWallet(address) {
        walletInstance = WalletContract.at(address);
    }
    
    function setEventWatchers() {
        walletNotify = walletInstance.Notify();
        
        // watch for changes
        walletNotify.watch(function(error, result){
            if (error) {
                console.log(error);
                return;
            }
            console.log(result);
        });
        
    //     var events = walletInstance.allEvents();
    //     events.watch(function(error, result){
    //         if (error) {
    //             console.log(error);
    //             return;
    //         }
    //         console.log(result);
    //     });
        
    }
    
    function spend() {
        walletInstance.setPhone("1234");
        walletInstance.spend(5678);
    }

</script>
</head>
<body onload="onload()">
    <h1>Oracle</h1>
    Sandbox:
    <div id="sandbox">---</div></br>
    Status:
    <div id="status">---</div></br>
    
    <div id="ui">
    
        <div>
            <button type="button" onClick="setEventWatchers();">read</button>
        </div>
        <div id="readResult">???</div>
        
        <div>
            <button type="button" onClick="spend();">write</button>
        </div>
        <div>
            <input type="number" id="writeValue"></input>
        </div>
    </div>

</body>
</html>

